<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <script src="../../../node_modules/blockly/blockly_compressed.js"></script>
    <script src="../../../node_modules/blockly/blocks_compressed.js"></script>
    <script src="../../../node_modules/blockly/msg/js/en.js"></script>
    
    <link rel="stylesheet" type="text/css" href="./style.css">
  </head>
  <body>
    <div id="blockly-div"></div>

    <xml id="toolbox">
      <category name="Control" colour="40">
        <block type="controls_if"></block>
        <block type="controls_if">
          <mutation else="1"></mutation>
        </block>
        <block type="controls_if">
          <mutation elseif="1" else="1"></mutation>
        </block>
      </category>
      <category name="Logic" colour="80">
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" colour="120">
        <block type="controls_repeat_ext"></block>
        <block type="controls_whileUntil"></block>
      </category>
      <category name="Math" colour="160">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
      </category>
      <category name="Text" colour="200">
        <block type="text"></block>
        <block type="text_print"></block>
      </category>
      <category name="Colors" colour="240" custom="COLOR_PALETTE"></category>
      <category name="Variables" custom="VARIABLE" colour="280">
      </category>
      <category name="Functions" custom="PROCEDURE" colour="320">
      </category>
    </xml>

    <script>
      var workspace = Blockly.inject('blockly-div', {
        toolbox: document.getElementById('toolbox'),
        css: true,
        toolboxPosition: 'start',
        scrollbars: false,
        horizontalLayout: false
      });

      workspace.registerToolboxCategoryCallback('COLOR_PALETTE', function(workspace) {
        // Returns an array of hex colours, e.g. ['#4286f4', '#ef0447']
        var colorList = ['#4286f4', '#ef0447'];
        var xmlList = [];
        if (Blockly.Blocks['colour_picker']) {
          for (var i = 0; i < colorList.length; i++) {
            var blockText = '<xml>' +
                '<block type="colour_picker">' +
                '<field name="COLOUR">' + colorList[i] + '</field>' +
                '</block>' +
                '</xml>';
            var block = Blockly.Xml.textToDom(blockText).firstChild;
            xmlList.push(block);
          }
        }
        return xmlList;
      });
    </script>
  </body>
</html>
